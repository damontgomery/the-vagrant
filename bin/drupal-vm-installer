#!/bin/sh
#
# Installer for the geerlingguy/drupal-vm.

# First, figure out the absolute paths for ALL the things.
SCRIPTPATH=$(cd `dirname $0` && pwd -P)

# Project root and config destination.
PROJECT_ROOT=$(cd "$SCRIPTPATH/../../" && pwd -P)
CONFIG_TEMPLATES="$PROJECT_ROOT/vendor/palantirnet/the-vagrant/conf/vagrant/drupalvm"
CONFIG_DESTINATION="$PROJECT_ROOT/conf/vagrant"

# Make sure the script is being run from the project root.
if [ "$(pwd)" == "$PROJECT_ROOT" ]; then
  default_projectname=${PWD##*/}
  read -p "Enter a short name for your project [${default_projectname}]: " projectname
  if [ "${projectname}" == "" ]; then
    projectname="${default_projectname}"
  fi

  # Copy Drupal-VM configuration and provisioning into the vm.
  mkdir -p "$CONFIG_DESTINATION"
  sed "s/@projectname@/${projectname}/g" "$CONFIG_TEMPLATES/config.yml" > "$CONFIG_DESTINATION/config.yml"
  cp "$CONFIG_TEMPLATES/Vagrantfile" Vagrantfile
  cp "$CONFIG_TEMPLATES/Vagrantfile.local" "$CONFIG_DESTINATION/"
  cp -r "$CONFIG_TEMPLATES/provisioning/" "$CONFIG_DESTINATION/provisioning"

  composer require --dev geerlingguy/drupal-vm:^4.2
else
  echo "Please run this command from your project root."
fi
